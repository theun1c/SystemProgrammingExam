## **üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ Windows Hooks?**

**–•—É–∫–∏ (Hooks)**¬†‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º Windows –¥–ª—è¬†**–ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Å–æ–±—ã—Ç–∏–π**¬†–¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ú–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ "–ø—Ä–æ—Å–ª—É—à–∫—É —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞" –∏–ª–∏ "–ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—á—Ç—ã –ø–µ—Ä–µ–¥ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–º".

## **üõ† –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**

| –°—Ü–µ–Ω–∞—Ä–∏–π                        | –ü—Ä–∏–º–µ—Ä                                             | –•—É–∫                            |
| ------------------------------- | -------------------------------------------------- | ------------------------------ |
| **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏**  | Ctrl+Shift+S –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –≤ –ª—é–±–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏      | `WH_KEYBOARD_LL`               |
| **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è/–º–∞–∫—Ä–æ—Å—ã**       | –ó–∞–ø–∏—Å—å –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –º—ã—à–∏             | `WH_MOUSE`,¬†`WH_JOURNALRECORD` |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥/–æ—Ç–ª–∞–¥–∫–∞**          | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç–ª–∞–¥—á–∏–∫        | `WH_GETMESSAGE`,¬†`WH_DEBUG`    |
| **Accessibility (–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å)** | –≠–∫—Ä–∞–Ω–Ω—ã–π –¥–∏–∫—Ç–æ—Ä, –ª—É–ø–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∑–≥–ª—è–¥–æ–º         | `WH_CBT`,¬†`WH_SHELL`           |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**                | –ê–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç –æ–ø–∞—Å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π             | `WH_CALLWNDPROC`               |
| **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞**      | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –≤ —á—É–∂–∏–µ –æ–∫–Ω–∞, –ø–µ—Ä–µ–≤–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ | `WH_CBT`                       |
**–û—Å–Ω–æ–≤–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:**
- **–ü–µ—Ä–µ—Ö–≤–∞—Ç –≤–≤–æ–¥–∞:**¬†–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –º—ã—à–∏ (–∫–µ–π–ª–æ–≥–≥–µ—Ä—ã, –º–∞–∫—Ä–æ—Å—ã, –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏)
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã:**¬†–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π, –æ—Ç–ª–∞–¥–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è:**¬†–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —á—É–∂–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π)
- **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (Accessibility):**¬†—ç–∫—Ä–∞–Ω–Ω—ã–µ –¥–∏–∫—Ç–æ—Ä—ã, –ª—É–ø—ã –¥–ª—è –ª—é–¥–µ–π —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**¬†–∞–Ω—Ç–∏–≤–∏—Ä—É—Å—ã –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –æ–ø–∞—Å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:**¬†–∑–∞–ø–∏—Å—å –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π

## üìä –¢–∏–ø—ã —Ö—É–∫–æ–≤ –ø–æ –æ–±–ª–∞—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è

### üè†¬†**–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ö—É–∫–∏**
- –î–µ–π—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞/–ø–æ—Ç–æ–∫–∞
- –ù–µ —Ç—Ä–µ–±—É—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- –ü—Ä–∏–º–µ—Ä: –æ—Ç–ª–∞–¥–∫–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
### üåç¬†**–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ö—É–∫–∏**
- –î–µ–π—Å—Ç–≤—É—é—Ç –≤–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ
- –¢—Ä–µ–±—É—é—Ç —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ–¥–∞ –≤ DLL (–±–∏–±–ª–∏–æ—Ç–µ–∫–µ)
- –ù—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ü—Ä–∏–º–µ—Ä: –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
### ‚ú®¬†**Low-Level —Ö—É–∫–∏**¬†(–æ—Å–æ–±—ã–π –≤–∏–¥ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö)
- –ù–µ —Ç—Ä–µ–±—É—é—Ç DLL (–∫–æ–¥ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ)
- –ü—Ä–æ—â–µ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- –ü—Ä–∏–º–µ—Ä: WH_KEYBOARD_LL, WH_MOUSE_LL

## ‚öôÔ∏è –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
### 1.¬†**DLL Injection –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ö—É–∫–æ–≤**¬†üíâ
–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ö—É–∫–∏ (–∫—Ä–æ–º–µ Low-Level) —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞—à–µ–π DLL –≤ –∫–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–∏—Å—Ç–µ–º—ã. –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç:
- –†–∏—Å–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ (–≤–∞—à –∫–æ–¥ –≤ —á—É–∂–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ)
- –ü—Ä–æ–±–ª–µ–º—ã —Å –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–∞–º–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
### 2.¬†**–¶–µ–ø–æ—á–∫–∞ —Ö—É–∫–æ–≤ (Hook Chain)**¬†üîó
–ù–µ—Å–∫–æ–ª—å–∫–æ —Ö—É–∫–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ. –û–Ω–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏. –ö–∞–∂–¥—ã–π —Ö—É–∫ —Ä–µ—à–∞–µ—Ç:
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ —Å–∞–º–æ–º—É
- –ü–µ—Ä–µ–¥–∞—Ç—å –¥–∞–ª—å—à–µ –ø–æ —Ü–µ–ø–æ—á–∫–µ (—á–µ—Ä–µ–∑¬†`CallNextHookEx()`)
### 3.¬†**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ü–∏–∫–ª —Å–æ–æ–±—â–µ–Ω–∏–π**¬†üîÑ
–•—É–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:
``` C
MSG msg;
while (GetMessage(&msg, NULL, 0, 0)) {
    TranslateMessage(&msg);
    DispatchMessage(&msg);
}
// –ë–µ–∑ —ç—Ç–æ–≥–æ —Ü–∏–∫–ª–∞ —Ö—É–∫ –Ω–µ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–±—ã—Ç–∏—è!
```

